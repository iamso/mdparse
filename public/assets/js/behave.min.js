/*
 * Behave.js
 *
 * Copyright 2013, Jacob Kelley - http://jakiestfu.com/
 * Released under the MIT Licence
 * http://opensource.org/licenses/MIT
 *
 * Github:  http://github.com/iamso/Behave.js/
 * Version: 1.7.1
 */
(function(a){"use strict";var b=b||function(){var a={};return{add:function(b,c){if("object"==typeof b){var d;for(d=0;d<b.length;d++){var e=b[d];a[e]||(a[e]=[]),a[e].push(c)}}else a[b]||(a[b]=[]),a[b].push(c)},get:function(b){return a[b]?a[b]:void 0}}}(),c=c||function(c){"function"!=typeof String.prototype.repeat&&(String.prototype.repeat=function(a){if(1>a)return"";if(a%2)return this.repeat(a-1)+this;var b=this.repeat(a/2);return b+b}),"function"!=typeof Array.prototype.filter&&(Array.prototype.filter=function(a){if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=[],e=arguments[1],f=0;c>f;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d});var d,e,f={textarea:null,replaceTab:!0,softTabs:!0,tabSize:4,autoOpen:!0,overwrite:!0,autoStrip:!0,autoIndent:!0,continueList:!0,fence:!1},g={keyMap:[{open:'"',close:'"',canBreak:!1},{open:"'",close:"'",canBreak:!1},{open:"(",close:")",canBreak:!1},{open:"[",close:"]",canBreak:!0},{open:"{",close:"}",canBreak:!0},{open:"<",close:">",canBreak:!1}]},h={_callHook:function(c,d,e){var g=b.get(c);if(e="boolean"==typeof e&&e===!1?!1:!0,g)if(e){var i,j=f.textarea,k=j.value,l=h.cursor.get();for(i=0;i<g.length;i++)g[i].call(a,{editor:{element:j,text:k,levelsDeep:h.levelsDeep()},caret:{pos:l},lines:{current:h.cursor.getLine(k,l),total:h.editor.getLines(k)}},d)}else for(i=0;i<g.length;i++)g[i].call(a,d)},defineNewLine:function(){var a=document.createElement("textarea");a.value="\n",e=2==a.value.length?"\r\n":"\n"},defineTabSize:function(a){return"undefined"!=typeof f.textarea.style.OTabSize?void(f.textarea.style.OTabSize=a):"undefined"!=typeof f.textarea.style.MozTabSize?void(f.textarea.style.MozTabSize=a):"undefined"!=typeof f.textarea.style.tabSize?void(f.textarea.style.tabSize=a):void 0},cursor:{getLine:function(a,b){return a.substring(0,b).split("\n").length},get:function(){if("number"==typeof document.createElement("textarea").selectionStart)return f.textarea.selectionStart;if(document.selection){var a=0,b=f.textarea.createTextRange(),c=document.selection.createRange().duplicate(),d=c.getBookmark();for(b.moveToBookmark(d);0!==b.moveStart("character",-1);)a++;return a}},set:function(a,b){if(b||(b=a),f.textarea.setSelectionRange)f.textarea.focus(),f.textarea.setSelectionRange(a,b);else if(f.textarea.createTextRange){var c=f.textarea.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select()}},selection:function(){var a,b,c,d,g,i=f.textarea,j=0,k=0;return"number"==typeof i.selectionStart&&"number"==typeof i.selectionEnd?(j=i.selectionStart,k=i.selectionEnd):(b=document.selection.createRange(),b&&b.parentElement()==i&&(a=h.editor.get(),d=a.length,c=i.createTextRange(),c.moveToBookmark(b.getBookmark()),g=i.createTextRange(),g.collapse(!1),c.compareEndPoints("StartToEnd",g)>-1?j=k=d:(j=-c.moveStart("character",-d),j+=a.slice(0,j).split(e).length-1,c.compareEndPoints("EndToEnd",g)>-1?k=d:(k=-c.moveEnd("character",-d),k+=a.slice(0,k).split(e).length-1)))),j==k?!1:{start:j,end:k}}},editor:{getLines:function(a){return a.split("\n").length},get:function(){return f.textarea.value.replace(/\r/g,"")},set:function(a){f.textarea.value=a}},fenceRange:function(){if("string"==typeof f.fence){for(var a=h.editor.get(),b=h.cursor.get(),c=0,d=a.indexOf(f.fence),e=0;d>=0&&(e++,!(d+c>b));)c+=d+f.fence.length,a=a.substring(d+f.fence.length),d=a.indexOf(f.fence);return b>c&&d+c>b&&e%2===0?!0:!1}return!0},isEven:function(a,b){return b%2},levelsDeep:function(){var a,b,c=h.cursor.get(),d=h.editor.get(),e=d.substring(0,c),f=0;for(a=0;a<e.length;a++)for(b=0;b<g.keyMap.length;b++)g.keyMap[b].canBreak&&(g.keyMap[b].open==e.charAt(a)&&f++,g.keyMap[b].close==e.charAt(a)&&f--);var i=0,j=["'",'"'];for(a=0;a<g.keyMap.length;a++)if(g.keyMap[a].canBreak)for(b in j)i+=e.split(j[b]).filter(h.isEven).join("").split(g.keyMap[a].open).length-1;var k=f-i;return k>=0?k:0},deepExtend:function(a,b){for(var c in b)b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},h.deepExtend(a[c],b[c])):a[c]=b[c];return a},addEvent:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},removeEvent:function(a,b,c){a.addEventListener?a.removeEventListener(b,c,!1):a.attachEvent&&a.detachEvent("on"+b,c)},preventDefaultEvent:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1}},i={tabKey:function(a){if(h.fenceRange()){if(9==a.keyCode){h.preventDefaultEvent(a);var b=!0;h._callHook("tab:before");var c=h.cursor.selection(),e=h.cursor.get(),f=h.editor.get();if(c){for(var g=c.start;g--;)if("\n"==f.charAt(g)){c.start=g+1;break}var i,j=f.substring(c.start,c.end),k=j.split("\n");if(a.shiftKey){for(i=0;i<k.length;i++)k[i].substring(0,d.length)==d&&(k[i]=k[i].substring(d.length));j=k.join("\n"),h.editor.set(f.substring(0,c.start)+j+f.substring(c.end)),h.cursor.set(c.start,c.start+j.length)}else{for(i in k)k[i]=d+k[i];j=k.join("\n"),h.editor.set(f.substring(0,c.start)+j+f.substring(c.end)),h.cursor.set(c.start,c.start+j.length)}}else{var l=f.substring(0,e),m=f.substring(e),n=l+d+m;a.shiftKey?f.substring(e-d.length,e)==d&&(n=f.substring(0,e-d.length)+m,h.editor.set(n),h.cursor.set(e-d.length)):(h.editor.set(n),h.cursor.set(e+d.length),b=!1)}h._callHook("tab:after")}return b}},enterKey:function(a){if(h.fenceRange()&&13==a.keyCode){h.preventDefaultEvent(a),h._callHook("enter:before");var b,c,f=h.cursor.get(),i=h.editor.get(),j=i.substring(0,f),k=i.substring(f),l=j.charAt(j.length-1),m=k.charAt(0),n=h.levelsDeep(),o="",p="";if(n){for(;n--;)o+=d;for(o=o,b=o.length+1,c=0;c<g.keyMap.length;c++)g.keyMap[c].open==l&&g.keyMap[c].close==m&&(p=e)}else b=1;var q=j+e+o+p+o.substring(0,o.length-d.length)+k;h.editor.set(q),h.cursor.set(f+b),h._callHook("enter:after")}},continueList:function(a){if(13==a.keyCode){h.preventDefaultEvent(a),h._callHook("enter:before");var b,c,d=h.cursor.get(),e=h.editor.get(),f=e.substring(0,d),g=e.substring(d),i=Math.max(0,f.split(/\r?\n/).length-2),j=e.split(/\r?\n/),k=j[i];(b=k.match(/^\s*([\-\–\—\+\*\•\·\»\>]|\d+\.)\s(\[[\sx]\]\s)?/))&&(k===b[0]?(d-=k.length,j[i]="",c=j.join("\n")):(c=f+b[0]+g,d+=b[0].length),h.editor.set(c),h.cursor.set(d)),h._callHook("enter:after")}},deleteKey:function(a){if(h.fenceRange()&&8==a.keyCode&&!a.altKey){h.preventDefaultEvent(a),h._callHook("delete:before");var b,c=h.cursor.get(),d=h.editor.get(),e=d.substring(0,c),f=d.substring(c),i=e.charAt(e.length-1),j=f.charAt(0);if(h.cursor.selection()===!1){for(b=0;b<g.keyMap.length;b++)if(g.keyMap[b].open==i&&g.keyMap[b].close==j){var k=d.substring(0,c-1)+d.substring(c+1);return h.editor.set(k),void h.cursor.set(c-1)}var k=d.substring(0,c-1)+d.substring(c);h.editor.set(k),h.cursor.set(c-1)}else{var l=h.cursor.selection(),k=d.substring(0,l.start)+d.substring(l.end);h.editor.set(k),h.cursor.set(c)}h._callHook("delete:after")}}},j={openedChar:function(a,b){h.preventDefaultEvent(b),h._callHook("openChar:before");var c=h.cursor.get(),d=h.editor.get(),e=d.substring(0,c),g=d.substring(c),i=e+a.open+a.close+g;f.textarea.value=i,h.cursor.set(c+1),h._callHook("openChar:after")},closedChar:function(a,b){var c=h.cursor.get(),d=h.editor.get(),e=d.substring(c,c+1);return e==a.close?(h.preventDefaultEvent(b),h._callHook("closeChar:before"),h.cursor.set(h.cursor.get()+1),h._callHook("closeChar:after"),!0):!1}},k={filter:function(a){if(h.fenceRange()){var b=a.which||a.keyCode;if(39!=b&&(40!=b||0!==a.which)){var c,d=String.fromCharCode(b);for(c=0;c<g.keyMap.length;c++)if(g.keyMap[c].close==d){var e=f.overwrite&&j.closedChar(g.keyMap[c],a);!e&&g.keyMap[c].open==d&&f.autoOpen&&j.openedChar(g.keyMap[c],a)}else g.keyMap[c].open==d&&f.autoOpen&&j.openedChar(g.keyMap[c],a)}}},listen:function(){f.replaceTab&&h.addEvent(f.textarea,"keydown",i.tabKey),f.autoIndent&&h.addEvent(f.textarea,"keydown",i.enterKey),f.autoStrip&&h.addEvent(f.textarea,"keydown",i.deleteKey),f.continueList&&h.addEvent(f.textarea,"keydown",i.continueList),h.addEvent(f.textarea,"keypress",k.filter),h.addEvent(f.textarea,"keydown",function(a){h._callHook("keydown",a)}),h.addEvent(f.textarea,"keyup",function(a){h._callHook("keyup",a)}),h.addEvent(f.textarea,"input",function(a){h._callHook("input",a)})}},l=function(a){a.textarea&&(h._callHook("init:before",null,!1),h.deepExtend(f,a),h.defineNewLine(),f.softTabs?d=" ".repeat(f.tabSize):(d="	",h.defineTabSize(f.tabSize)),k.listen(),h._callHook("init:after",null,!1))};this.editor=h.editor,this.cursor=h.cursor,this.destroy=function(){h.removeEvent(f.textarea,"keydown",i.tabKey),h.removeEvent(f.textarea,"keydown",i.enterKey),h.removeEvent(f.textarea,"keydown",i.deleteKey),h.removeEvent(f.textarea,"keydown",i.continueList),h.removeEvent(f.textarea,"keypress",k.filter),h.removeEvent(f.textarea,"keydown",function(a){h._callHook("keydown",a)}),h.removeEvent(f.textarea,"keyup",function(a){h._callHook("keyup",a)}),h.removeEvent(f.textarea,"input",function(a){h._callHook("input",a)})},l(c)};"undefined"!=typeof module&&module.exports&&(module.exports=c),"undefined"==typeof ender&&(this.Behave=c,this.BehaveHooks=b),"function"==typeof define&&define.amd&&define("behave",[],function(){return c})}).call(this);
//# sourceMappingURL=behave.min.js.map